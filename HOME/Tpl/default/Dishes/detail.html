<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>OrderOnline - deatail</title>
<link rel="stylesheet" href="__PUBLIC__/Index/css/reset.css" />
<link rel="stylesheet" href="__PUBLIC__/Index/css/public.css" />
<link rel="stylesheet" href="__PUBLIC__/Index/css/top.css" />
<link rel="stylesheet" href="__PUBLIC__/Index/css/detail.css" />
<link rel="stylesheet" href="__PUBLIC__/Index/css/foot.css" />
<link href="__PUBLIC__/Index/css/popup.css" rel="stylesheet" type="text/css" />

<script type="text/javascript" src="__PUBLIC__/Index/js/jquery-1.7.1.js"></script>
<script type="text/javascript" src="__PUBLIC__/Index/js/jquery-extend-order.js"></script>
<script type="text/javascript" src="__PUBLIC__/Index/js/main.js"></script>
<script type="text/javascript" src="__PUBLIC__/Index/js/public.js"></script>
<!--<script src="http://maps.google.cn/maps?file=api&ampv=2&ampkey=your key&sensor=true" type="text/javascript"></script>-->
</head>

<body>
	<div class="container">
    	<include file="Index:head" />
    	<include file="Index:search" />
        
    	<include file="Index:resinfo" />
            <div class="context">
              <div class="menu">
            	<div class="title">
                    Click whatever you like to start your order.
                </div>
                <div class="list">
                    <div class="top"><span class="ico"></span>Package</div>
                    <ul class="clearfix">
                    <volist name="list_package" id="va">
                        <li resid="{$va['restaurant_id']}" packid="{$va['id']}">
                        <if condition="$v['is_commend'] eq '1'">
                            <span class="ico1 ico"></span>
                         </if>
                         <if condition="$v['peanut'] eq '1'">
                            <span class="ico2 ico"></span>
                         </if>
                         <if condition="$v['spicy'] eq '1'">
                            <span class="ico3 ico"></span>    
                         </if>
                         
                            <span class="name">{$va['group_name']}</span><span class="price">${$va['price']}</span>
                        </li>
                        
                    </volist>   
                    </ul>
                </div>
               <volist name="list" id="vo">
                <div class="list">
                	<div class="top"><span class="ico"></span>{$vo['group_name']}</div>
                    <ul class="clearfix">
                    <volist name="vo['dishes']" id="v">
                    	<li resid="{$v['restaurant_id']}" disid="{$v['id']}">
                        <if condition="$v['is_commend'] eq '1'">
                            <span class="ico1 ico"></span>
                         </if>
                         <if condition="$v['peanut'] eq '1'">
                         	<span class="ico2 ico"></span>
                         </if>
                         <if condition="$v['spicy'] eq '1'">
                         	<span class="ico3 ico"></span>    
                         </if>
                         
                            <span class="name">{$v['item_name']}</span><span class="price">${$v['price']}</span>
                        </li>
                        
		    </volist>	
                    </ul>
                </div>
                </volist>
            </div>

    	    <include file="Index:order" />

            </div>
        </div>
    </div>
    <div class="foot"></div>
    <div class="popup_layer"></div>
<if condition='cookie("OrderOnlineAuth") neq ""'>
    <div class="shopping_cart">
   
        <div class="cart_title clearfix" flag=true>
            <a class="lt" num="0" href="#">Your Order</a>
            <a class="rt" href="#">{$ordernum}</a>
        </div>
        
        <ul>
         <volist name="order" id="vo">
            <li class="clearfix">
                <a href="javascript:;" class="area lt">{$vo['item_name']}</a>&nbsp;<span class="price rt">${$vo['price']}</span>
                <a href="javascript:;" class="name lt">{$vo['quantity']} Piece,{:substr($vo['item'],0,13)}</a>
                <span class="num rt"><a class="reduce" href="javascript:;" s_id="{$vo['id']}"></a><span class="qty">{$vo['quantity']}</span><a class="add" href="javascript:;" s_id="{$vo['id']}"></a></span>
            </li>
            
            </volist>
            <li class="last"><a href="{:U('Member/placeOrder?res_id=1')}">Ready</a></li>
        </ul>
       
    </div>
   </if>
<script type="text/javascript">
$(document).ready(function()
{
    $(".reduce").live('click',function(){
        var val = parseInt($(this).siblings(".qty").html());
        if(val>1){
            var old_price = $(this).parents('.orderitem').find('.price').html().substr(1);
            var unit_price = $(this).parents('.orderitem').attr('data-price');
            var newprice = parseFloat(old_price) - parseFloat(unit_price);

            $(this).siblings(".qty").html(val-1);
            $(this).parents('.orderitem').find('.price').html('$' + newprice.toFixed(2));
        }else{
            $(this).parents(".orderitem").remove();
        }
        var id = $(this).attr("s_id");
        $.post("{:U('Dishes/reduceQty')}",{id:id},function(){
        },'json');
        calSubTotal();
    })

    $(".add").live('click',function(){
        var val = parseInt($(this).siblings(".qty").html());	
        var old_price = $(this).parents('.orderitem').find('.price').html().substr(1);
        var unit_price = $(this).parents('.orderitem').attr('data-price');
        var id = $(this).attr("s_id");
        
        var newprice = parseFloat(old_price) + parseFloat(unit_price);
        $(this).parents('.orderitem').find('.price').html('$'+ newprice.toFixed(2));
        $(this).siblings(".qty").html(val+1);
        $.post("{:U('Dishes/addQty')}",{id:id},function(){
        });
        calSubTotal();
    });

    function calSubTotal(){
        //var subTotal = parseFloat($(".orderItem").find(".price").html().substr(1))-price;
        var subTotal = 0;
        $('.orderitem').each(function(){
            subTotal += parseFloat($(this).find('.price').html().substr(1)); 
        });

        var tax = subTotal * 0.05;
        var allTotal = subTotal + tax;
        $('.sub-total').html('$' + subTotal.toFixed(2));
        $('.tax').html('$' + tax.toFixed(2));

        $('.all-total').html('$' + allTotal.toFixed(2));
        //console.log(subTotal);
    };

    calSubTotal();

    $(".order").smartFloat();
});
</script>
</body>
</html>
